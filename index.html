<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>RespiraÃ§Ã£o 4-7-8</title>

<style>
:root {
  --bg: linear-gradient(135deg, #b6e3ff, #eef9ff);
  --card: rgba(255,255,255,.85);
  --text: #03314b;
  --sub: #355f73;
  --btn: #4aa3c7;
}

body.dark {
  --bg: linear-gradient(135deg, #0f2027, #203a43);
  --card: rgba(20,30,40,.9);
  --text: #eaf6ff;
  --sub: #aac6d6;
  --btn: #5fb3d6;
}

* {
  box-sizing: border-box;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
}

body {
  margin: 0;
  min-height: 100vh;
  background: var(--bg);
  display: flex;
  align-items: center;
  justify-content: center;
  color: var(--text);
  padding: 16px;
  transition: background .3s;
}

.container {
  background: var(--card);
  backdrop-filter: blur(10px);
  padding: 28px;
  border-radius: 24px;
  max-width: 380px;
  width: 100%;
  text-align: center;
  box-shadow: 0 20px 40px rgba(0,0,0,.15);
}

h1 { margin: 0 0 8px; }
p { color: var(--sub); }

.circle {
  width: clamp(160px, 55vw, 220px);
  height: clamp(160px, 55vw, 220px);
  margin: 24px auto;
  border-radius: 50%;
  background: radial-gradient(circle at top, #9adcf7, #4aa3c7);
  transform: scale(.6);
  transition: transform linear, box-shadow linear;
  box-shadow: 0 0 10px rgba(79,163,199,.2);
}

.circle.grow {
  transform: scale(1);
  box-shadow: 0 0 45px rgba(79,163,199,.6);
}

.phase { font-size: 1.3rem; font-weight: 600; }
.timer { font-size: 2.6rem; font-weight: bold; }

.controls {
  display: flex;
  gap: 10px;
  justify-content: center;
  flex-wrap: wrap;
  margin-top: 20px;
}

button {
  padding: 12px 22px;
  border-radius: 999px;
  border: none;
  font-size: 1rem;
  background: var(--btn);
  color: white;
  cursor: pointer;
}

button.secondary {
  background: #9aaeb8;
}

input {
  width: 80px;
  padding: 8px;
  border-radius: 8px;
  border: 1px solid #ccc;
  text-align: center;
}

.toggle {
  margin-top: 16px;
  cursor: pointer;
  font-size: .9rem;
}
</style>
</head>

<body>
<div class="container">
  <h1>RespiraÃ§Ã£o 4-7-8</h1>
  <p>ExercÃ­cio guiado para acalmar mente e corpo</p>

  <div class="circle" id="circle"></div>

  <div class="phase" id="phase">Pronto?</div>
  <div class="timer" id="timer">â€”</div>

  <div style="margin-top:12px">
    Ciclos:
    <input type="number" id="cyclesInput" min="1" max="20" value="4">
  </div>

  <div class="controls">
    <button id="startBtn">Iniciar</button>
    <button id="stopBtn" class="secondary" style="display:none">Parar</button>
  </div>

  <div class="toggle" id="darkToggle">ðŸŒ™ Modo escuro</div>
</div>

<script>
const phaseEl = document.getElementById('phase');
const timerEl = document.getElementById('timer');
const circle = document.getElementById('circle');
const startBtn = document.getElementById('startBtn');
const stopBtn = document.getElementById('stopBtn');
const cyclesInput = document.getElementById('cyclesInput');
const darkToggle = document.getElementById('darkToggle');

let interval, running = false, cycleCount = 0;

// ðŸ”Š Ãudio
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
function playSound(freq, duration = .3) {
  const osc = audioCtx.createOscillator();
  const gain = audioCtx.createGain();
  osc.frequency.value = freq;
  gain.gain.value = 0.05;
  osc.connect(gain).connect(audioCtx.destination);
  osc.start();
  osc.stop(audioCtx.currentTime + duration);
}

// ðŸ“³ VibraÃ§Ã£o
function vibrate(ms = 100) {
  if (navigator.vibrate) navigator.vibrate(ms);
}

const phases = [
  { label: 'Inspire', seconds: 4, action: 'grow', sound: 220 },
  { label: 'Segure', seconds: 7, action: 'hold', sound: 160 },
  { label: 'Expire', seconds: 8, action: 'shrink', sound: 320 }
];

function startExercise() {
  if (running) return;
  running = true;
  cycleCount = 0;

  startBtn.style.display = 'none';
  stopBtn.style.display = 'inline-block';

  let phaseIndex = 0;

  function runPhase() {
  if (!running) return;

  const phase = phases[phaseIndex];
  let remaining = phase.seconds;

  phaseEl.textContent = phase.label;
  timerEl.textContent = remaining;

  playSound(phase.sound);
  vibrate();

  // ðŸ”´ RESETA estado sempre
  circle.classList.remove('grow', 'shrink');

  if (phase.action === 'grow') {
    circle.style.transitionDuration = phase.seconds + 's';
    circle.classList.add('grow');
  }

  if (phase.action === 'hold') {
    // ðŸ”’ Bola parada
    circle.style.transitionDuration = '0s';
  }

  if (phase.action === 'shrink') {
    circle.style.transitionDuration = phase.seconds + 's';
    circle.classList.add('shrink');
  }

  interval = setInterval(() => {
    remaining--;
    timerEl.textContent = remaining;

    if (remaining <= 0) {
      clearInterval(interval);
      phaseIndex++;

      if (phaseIndex >= phases.length) {
        phaseIndex = 0;
        cycleCount++;
        if (cycleCount >= cyclesInput.value) {
          stopExercise(true);
          return;
        }
      }
      runPhase();
    }
  }, 1000);
}
  runPhase();
}

function stopExercise(finished = false) {
  running = false;
  clearInterval(interval);

  phaseEl.textContent = finished ? 'ConcluÃ­do ðŸŒ¿' : 'Parado';
  timerEl.textContent = 'â€”';

  circle.classList.remove('grow','shrink');
  circle.style.transform = 'scale(.6)';

  startBtn.style.display = 'inline-block';
  stopBtn.style.display = 'none';
}

startBtn.onclick = startExercise;
stopBtn.onclick = () => stopExercise();

// ðŸŒ™ Dark mode
darkToggle.onclick = () => {
  document.body.classList.toggle('dark');
};
</script>
</body>
</html>
